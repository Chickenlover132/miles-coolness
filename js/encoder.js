!function(){const e=(e,t)=>(e%t+t)%t,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~-",n="_rhs";class s{constructor(e=function(){let e="",n=t.split("");for(;n.length>0;)e+=n.splice(Math.floor(Math.random()*n.length),1)[0];return e}()){this.dictionary=e}shuffle(s){if(s.startsWith(n))return s;let o="";for(let n=0;n<s.length;n++){const r=s.charAt(n),i=t.indexOf(r);"%"===r&&s.length-n>=3?(o+=r,o+=s.charAt(++n),o+=s.charAt(++n)):o+=-1===i?r:this.dictionary.charAt(e(i+n,64))}return n+o}unshuffle(s){if(!s.startsWith(n))return s;s=s.slice(4);let o="";for(let n=0;n<s.length;n++){const r=s.charAt(n),i=this.dictionary.indexOf(r);"%"===r&&s.length-n>=3?(o+=r,o+=s.charAt(++n),o+=s.charAt(++n)):o+=-1===i?r:t.charAt(e(i-n,64))}return o}}function o(e){console.log(e)}function r(e,t,n=!1){var s,r=(s=document.getElementById("session-password"))?s.value:"";r&&(e.includes("?")?e+="&pwd="+r:e+="?pwd="+r);var i=new XMLHttpRequest;i.open("GET",e,!0),i.send(),i.onerror=function(){n||o("Cannot communicate with the server")},i.onload=function(){200===i.status?t(i.responseText):n||o('unexpected server response to not match "200". Server says "'+i.responseText+'"')}}var i={needpassword(e){r("/needpassword",(t=>e("true"===t)))},newsession(e){r("/newsession",e)},editsession(e,t,n,s){r("/editsession?id="+encodeURIComponent(e)+(t?"&httpProxy="+encodeURIComponent(t):"")+"&enableShuffling="+(n?"1":"0"),(function(e){if("Success"!==e)return o("unexpected response from server. received "+e);s()}))},sessionexists(e,t){r("/sessionexists?id="+encodeURIComponent(e),(function(e){return"exists"===e?t(!0):"not found"===e?t(!1):void o("unexpected response from server. received"+e)}))},deletesession(e,t){i.sessionexists(e,(function(n){n?r("/deletesession?id="+e,(function(e){if("Success"!==e&&"not found"!==e)return o("unexpected response from server. received "+e);t()})):t()}))},shuffleDict(e,t){r("/api/shuffleDict?id="+encodeURIComponent(e),(function(e){t(JSON.parse(e))}))}},a="rammerhead_sessionids",c="rammerhead_default_sessionid",u={get(){var e=localStorage.getItem(a);if(!e)return[];try{var t=JSON.parse(e);if(!Array.isArray(t))throw"getout";return t}catch(e){return[]}},set(e){if(!e||!Array.isArray(e))throw new TypeError("must be array");localStorage.setItem(a,JSON.stringify(e))},getDefault(){var e=localStorage.getItem(c);if(e){var t=u.get();if(t.filter((function(t){return t.id===e})),t.length)return t[0]}return null},setDefault(e){localStorage.setItem(c,e)}};function l(e){console.log("Still do nothing.")}function f(){u.get();var e=u.getDefault();e&&console.log("Do nothing"),l()}window.addEventListener("load",(function(){function e(){o();var e=localStorage.getItem("session-string"),t=document.getElementById("home-input").value||"https://www.google.com/";if(!e)return o("must generate a session id first");i.sessionexists(e,(function(n){if(!n)return o("session does not exist. try deleting or generating a new session");i.editsession(e,"",true,(function(){!function(e,t,n){for(var s=u.get(),o=0;o<s.length;o++)if(s[o].id===e)return s[o].httpproxy=t,s[o].enableShuffling=n,void u.set(s);throw new TypeError("cannot find "+e)}(e,"",true),i.shuffleDict(e,(function(n){let o=document.querySelector(".proxy-iframe");if(o||console.log("[ERROR] iframe not found! Try reloading."),function(e=""){return!!(/^http(s?):\/\//.test(e)||e.includes(".")&&" "!==e.substr(0,1))}(t)||(t=(localStorage.getItem("search-engine")||"https://www.google.com/search?q=%s").replace("%s",encodeURIComponent(t))),n){var r=new s(n);o.src="/"+e+"/"+r.shuffle(t)}else o.src="/"+e+"/"+t}))}))}))}f(),localStorage.getItem("session-string")||(o(),i.newsession((function(e){!function(e){var t=u.get();t.unshift({id:e,createdOn:(new Date).toLocaleString()}),u.set(t),l()}(e),localStorage.setItem("session-string",e),alert(e)}))),"rammerhead"==Cookies.get("astro-proxy").toLowerCase()&&document.getElementById("home-input").addEventListener("keydown",(t=>{"Enter"===t.key&&e()}))}))}();